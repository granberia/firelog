---
layout: default
refactor: true
panel_includes:
  - toc
tail_includes:
  - related-posts
  - post-nav
script_includes:
  - comment
---

{% include lang.html %} {% include toc-status.html %}

<article class="px-1" data-toc="{{ enable_toc }}">
  <header>
    <h1 data-toc-skip>{{ page.title }}</h1>
    {% if page.description %}
    <p class="post-desc fw-light mb-4">{{ page.description }}</p>
    {% endif %}

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        {{ site.data.locales[lang].post.posted }} {% include datetime.html
        date=page.date tooltip=true lang=lang %}
      </span>

      <!-- lastmod date -->
      {% if page.last_modified_at and page.last_modified_at != page.date %}
      <span>
        {{ site.data.locales[lang].post.updated }} {% include datetime.html
        date=page.last_modified_at tooltip=true lang=lang %}
      </span>
      {% endif %}

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          {% if page.author %} {% assign authors = page.author %} {% elsif
          page.authors %} {% assign authors = page.authors %} {% endif %} {{
          site.data.locales[lang].post.written_by }}

          <em>
            {% if authors %} {% for author in authors %} {% if
            site.data.authors[author].url -%}
            <a href="{{ site.data.authors[author].url }}"
              >{{ site.data.authors[author].name }}</a
            >
            {%- else -%} {{ site.data.authors[author].name }} {%- endif %} {%
            unless forloop.last %}{{ '</em
          >,
          <em
            >' }}{% endunless %} {% endfor %} {% else %}
            <a href="{{ site.social.links[0] }}">{{ site.social.name }}</a>
            {% endif %}
          </em>
        </span>

        <div>
          <!-- pageviews -->
          {% if site.pageviews.provider and
          site.analytics[site.pageviews.provider].id %}
          <span>
            <em id="pageviews">
              <i class="fas fa-spinner fa-spin small"></i>
            </em>
            {{ site.data.locales[lang].post.pageview_measure }}
          </span>
          {% endif %}

          <!-- read time -->
          {% include read-time.html content=content prompt=true lang=lang %}
        </div>
      </div>
    </div>
  </header>

  <!-- 암호화된 포스트 -->
  {% if page.encrypt%} {% if enable_toc %}
  <div
    id="toc-bar"
    class="d-flex align-items-center justify-content-between invisible"
  >
    <span class="label text-truncate">{{ page.title }}</span>
    <button type="button" class="toc-trigger btn me-1">
      <i class="fa-solid fa-list-ul fa-fw"></i>
    </button>
  </div>
  <button
    id="toc-solo-trigger"
    type="button"
    class="toc-trigger btn btn-outline-secondary btn-sm"
  >
    <span class="label ps-2 pe-1"
      >{{- site.data.locales[lang].panel.toc -}}</span
    >
    <i class="fa-solid fa-angle-right fa-fw"></i>
  </button>
  <dialog id="toc-popup" class="p-0">
    <div
      class="header d-flex flex-row align-items-center justify-content-between"
    >
      <div class="label text-truncate py-2 ms-4">{{- page.title -}}</div>
      <button
        id="toc-popup-close"
        type="button"
        class="btn mx-1 my-1 opacity-75"
      >
        <i class="fas fa-close"></i>
      </button>
    </div>
    <div id="toc-popup-content" class="px-4 py-3 pb-4"></div>
  </dialog>
  {% endif %}

  <!-- 본문 영역을 복호화 UI로 교체 -->
  <div class="content">
    <div id="decryption-wrapper" class="text-center p-4 border rounded">
      <i class="fa-solid fa-lock fa-2x mb-3"></i>
      <p class="mb-3">
        이 포스트는 암호화되어 있습니다. 내용을 보려면 비밀번호를 입력하세요.
      </p>
      <div class="input-group mb-3 mx-auto" style="max-width: 300px">
        <input
          type="password"
          id="password-input"
          class="form-control"
          placeholder="비밀번호"
          aria-label="Password"
        />
        <button id="decrypt-button" class="btn btn-primary" type="button">
          확인
        </button>
      </div>
      <p id="error-message" class="text-danger small" style="display: none">
        비밀번호가 올바르지 않습니다.
      </p>
    </div>
    <!-- 암호화된 본문을 Javascript에서 사용할 수 있도록 숨겨둡니다. -->
    <div id="encrypted-data" style="display: none">{{ content }}</div>
    <!-- 복호화된 내용이 여기에 삽입됩니다. -->
    <div id="decrypted-content" style="display: none"></div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      if (document.getElementById("decryption-wrapper")) {
        const decryptButton = document.getElementById("decrypt-button");
        const passwordInput = document.getElementById("password-input");
        const encryptedData = document
          .getElementById("encrypted-data")
          .innerHTML.trim();

        const decryptAndDisplay = () => {
          const secretKey = passwordInput.value;
          const errorMessage = document.getElementById("error-message");

          if (!secretKey) return;

          try {
            const decryptedBytes = CryptoJS.AES.decrypt(
              encryptedData,
              secretKey
            );
            const decryptedText = decryptedBytes.toString(CryptoJS.enc.Utf8);

            if (decryptedText) {
              const decryptedContent =
                document.getElementById("decrypted-content");
              decryptedContent.innerHTML = decryptedText;

              document.getElementById("decryption-wrapper").style.display =
                "none";
              decryptedContent.style.display = "block";

              if (typeof window.toc !== "undefined") {
                window.toc.init();
              }
            } else {
              throw new Error("Decryption resulted in empty content.");
            }
          } catch (e) {
            errorMessage.style.display = "block";
            passwordInput.focus();
            console.error("Decryption failed:", e);
          }
        };

        decryptButton.addEventListener("click", decryptAndDisplay);
        passwordInput.addEventListener("keyup", (event) => {
          if (event.key === "Enter") {
            decryptButton.click();
          }
        });
      }
    });
  </script>

  {% else %}
  <!-- 일반 포스트 -->

  {% if enable_toc %}
  <div
    id="toc-bar"
    class="d-flex align-items-center justify-content-between invisible"
  >
    <span class="label text-truncate">{{ page.title }}</span>
    <button type="button" class="toc-trigger btn me-1">
      <i class="fa-solid fa-list-ul fa-fw"></i>
    </button>
  </div>

  <button
    id="toc-solo-trigger"
    type="button"
    class="toc-trigger btn btn-outline-secondary btn-sm"
  >
    <span class="label ps-2 pe-1"
      >{{- site.data.locales[lang].panel.toc -}}</span
    >
    <i class="fa-solid fa-angle-right fa-fw"></i>
  </button>

  <dialog id="toc-popup" class="p-0">
    <div
      class="header d-flex flex-row align-items-center justify-content-between"
    >
      <div class="label text-truncate py-2 ms-4">{{- page.title -}}</div>
      <button
        id="toc-popup-close"
        type="button"
        class="btn mx-1 my-1 opacity-75"
      >
        <i class="fas fa-close"></i>
      </button>
    </div>
    <div id="toc-popup-content" class="px-4 py-3 pb-4"></div>
  </dialog>
  {% endif %}

  <div class="content">{{ content }}</div>
  {% endif %}

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    {% if page.categories.size > 0 %}
    <div class="post-meta mb-3">
      <i class="far fa-folder-open fa-fw me-1"></i>
      {% for category in page.categories %}
      <a
        href="{{ site.baseurl }}/categories/{{ category | slugify | url_encode }}/"
        >{{ category }}</a
      >
      {%- unless forloop.last -%},{%- endunless -%} {% endfor %}
    </div>
    {% endif %}

    <!-- tags -->
    {% if page.tags.size > 0 %}
    <div class="post-tags">
      <i class="fa fa-tags fa-fw me-1"></i>
      {% for tag in page.tags %}
      <a
        href="{{ site.baseurl }}/tags/{{ tag | slugify | url_encode }}/"
        class="post-tag no-text-decoration"
      >
        {{- tag -}}
      </a>
      {% endfor %}
    </div>
    {% endif %}

    <div
      class="post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2"
    >
      <div class="license-wrapper">
        {% if site.data.locales[lang].copyright.license.template %} {% capture
        _replacement %}
        <a href="{{ site.data.locales[lang].copyright.license.link }}">
          {{ site.data.locales[lang].copyright.license.name }}
        </a>
        {% endcapture %} {{ site.data.locales[lang].copyright.license.template |
        replace: ':LICENSE_NAME', _replacement }} {% endif %}
      </div>

      {% include post-sharing.html lang=lang %}
    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>
